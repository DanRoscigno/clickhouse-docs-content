"use strict";(self.webpackChunkclickhouse=self.webpackChunkclickhouse||[]).push([[4435],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return E}});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),p=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=p(e.components);return r.createElement(l.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=p(t),E=a,N=u["".concat(l,".").concat(E)]||u[E]||c[E]||i;return t?r.createElement(N,o(o({ref:n},d),{},{components:t})):r.createElement(N,o({ref:n},d))}));function E(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,o=new Array(i);o[0]=u;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=t[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},38344:function(e,n,t){t.r(n),t.d(n,{assets:function(){return d},contentTitle:function(){return l},default:function(){return E},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return c}});var r=t(87462),a=t(63366),i=(t(67294),t(3905)),o=["components"],s={slug:"/en/getting-started/example-datasets/uk-price-paid",sidebar_label:"UK Property Price Paid",sidebar_position:1,title:"UK Property Price Paid"},l=void 0,p={unversionedId:"en/getting-started/example-datasets/uk-price-paid",id:"en/getting-started/example-datasets/uk-price-paid",title:"UK Property Price Paid",description:"The dataset contains data about prices paid for real-estate property in England and Wales. The data is available since year 1995.",source:"@site/docs/en/getting-started/example-datasets/uk-price-paid.md",sourceDirName:"en/getting-started/example-datasets",slug:"/en/getting-started/example-datasets/uk-price-paid",permalink:"/docs/en/getting-started/example-datasets/uk-price-paid",draft:!1,editUrl:"https://github.com/ClickHouse/ClickHouse/tree/master/docs/en/getting-started/example-datasets/uk-price-paid.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{slug:"/en/getting-started/example-datasets/uk-price-paid",sidebar_label:"UK Property Price Paid",sidebar_position:1,title:"UK Property Price Paid"},sidebar:"english",previous:{title:"ClickHouse Tutorial",permalink:"/docs/en/tutorial"},next:{title:"New York Taxi Data",permalink:"/docs/en/getting-started/example-datasets/nyc-taxi"}},d={},c=[{value:"Create the Table",id:"create-table",level:2},{value:"Preprocess and Insert the Data",id:"preprocess-import-data",level:2},{value:"Validate the Data",id:"validate-data",level:2},{value:"Run Some Queries",id:"run-queries",level:2},{value:"Query 1. Average Price Per Year",id:"average-price",level:3},{value:"Query 2. Average Price per Year in London",id:"average-price-london",level:3},{value:"Query 3. The Most Expensive Neighborhoods",id:"most-expensive-neighborhoods",level:3},{value:"Let&#39;s Speed Up Queries Using Projections",id:"speedup-with-projections",level:2},{value:"Build a Projection",id:"build-projection",level:3},{value:"Test Performance",id:"test-performance",level:2},{value:"Query 1. Average Price Per Year",id:"average-price-projections",level:3},{value:"Query 2. Average Price Per Year in London",id:"average-price-london-projections",level:3},{value:"Query 3. The Most Expensive Neighborhoods",id:"most-expensive-neighborhoods-projections",level:3},{value:"Test it in the Playground",id:"playground",level:3}],u={toc:c};function E(e){var n=e.components,t=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The dataset contains data about prices paid for real-estate property in England and Wales. The data is available since year 1995.\nThe size of the dataset in uncompressed form is about 4 GiB and it will take about 278 MiB in ClickHouse."),(0,i.kt)("p",null,"Source: ",(0,i.kt)("a",{parentName:"p",href:"https://www.gov.uk/government/statistical-data-sets/price-paid-data-downloads"},"https://www.gov.uk/government/statistical-data-sets/price-paid-data-downloads"),"\nDescription of the fields: ",(0,i.kt)("a",{parentName:"p",href:"https://www.gov.uk/guidance/about-the-price-paid-data"},"https://www.gov.uk/guidance/about-the-price-paid-data")),(0,i.kt)("p",null,"Contains HM Land Registry data \xa9 Crown copyright and database right 2021. This data is licensed under the Open Government Licence v3.0."),(0,i.kt)("h2",{id:"create-table"},"Create the Table"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE uk_price_paid\n(\n    price UInt32,\n    date Date,\n    postcode1 LowCardinality(String),\n    postcode2 LowCardinality(String),\n    type Enum8('terraced' = 1, 'semi-detached' = 2, 'detached' = 3, 'flat' = 4, 'other' = 0),\n    is_new UInt8,\n    duration Enum8('freehold' = 1, 'leasehold' = 2, 'unknown' = 0),\n    addr1 String,\n    addr2 String,\n    street LowCardinality(String),\n    locality LowCardinality(String),\n    town LowCardinality(String),\n    district LowCardinality(String),\n    county LowCardinality(String)\n)\nENGINE = MergeTree\nORDER BY (postcode1, postcode2, addr1, addr2);\n")),(0,i.kt)("h2",{id:"preprocess-import-data"},"Preprocess and Insert the Data"),(0,i.kt)("p",null,"We will use the ",(0,i.kt)("inlineCode",{parentName:"p"},"url")," function to stream the data into ClickHouse. We need to preprocess some of the incoming data first, which includes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"splitting the ",(0,i.kt)("inlineCode",{parentName:"li"},"postcode")," to two different columns - ",(0,i.kt)("inlineCode",{parentName:"li"},"postcode1")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"postcode2"),", which is better for storage and queries"),(0,i.kt)("li",{parentName:"ul"},"converting the ",(0,i.kt)("inlineCode",{parentName:"li"},"time")," field to date as it only contains 00:00 time"),(0,i.kt)("li",{parentName:"ul"},"ignoring the ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/data-types/uuid"},"UUid")," field because we don't need it for analysis"),(0,i.kt)("li",{parentName:"ul"},"transforming ",(0,i.kt)("inlineCode",{parentName:"li"},"type")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"duration")," to more readable ",(0,i.kt)("inlineCode",{parentName:"li"},"Enum")," fields using the ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/functions/other-functions#transform"},"transform")," function"),(0,i.kt)("li",{parentName:"ul"},"transforming the ",(0,i.kt)("inlineCode",{parentName:"li"},"is_new")," field from a single-character string (",(0,i.kt)("inlineCode",{parentName:"li"},"Y"),"/",(0,i.kt)("inlineCode",{parentName:"li"},"N"),") to a ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/data-types/int-uint#uint8-uint16-uint32-uint64-uint256-int8-int16-int32-int64-int128-int256"},"UInt8")," field with 0 or 1"),(0,i.kt)("li",{parentName:"ul"},"drop the last two columns since they all have the same value (which is 0)")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"url")," function streams the data from the web server into your ClickHouse table. The following command inserts 5 million rows into the ",(0,i.kt)("inlineCode",{parentName:"p"},"uk_price_paid")," table:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO uk_price_paid\nWITH\n   splitByChar(' ', postcode) AS p\nSELECT\n    toUInt32(price_string) AS price,\n    parseDateTimeBestEffortUS(time) AS date,\n    p[1] AS postcode1,\n    p[2] AS postcode2,\n    transform(a, ['T', 'S', 'D', 'F', 'O'], ['terraced', 'semi-detached', 'detached', 'flat', 'other']) AS type,\n    b = 'Y' AS is_new,\n    transform(c, ['F', 'L', 'U'], ['freehold', 'leasehold', 'unknown']) AS duration,\n    addr1,\n    addr2,\n    street,\n    locality,\n    town,\n    district,\n    county\nFROM url(\n    'http://prod.publicdata.landregistry.gov.uk.s3-website-eu-west-1.amazonaws.com/pp-complete.csv',\n    'CSV',\n    'uuid_string String,\n    price_string String,\n    time String,\n    postcode String,\n    a String,\n    b String,\n    c String,\n    addr1 String,\n    addr2 String,\n    street String,\n    locality String,\n    town String,\n    district String,\n    county String,\n    d String,\n    e String'\n) SETTINGS max_http_get_redirects=10;\n")),(0,i.kt)("p",null,"Wait for the data to insert - it will take a minute or two depending on the network speed."),(0,i.kt)("h2",{id:"validate-data"},"Validate the Data"),(0,i.kt)("p",null,"Let's verify it worked by seeing how many rows were inserted:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT count()\nFROM uk_price_paid\n")),(0,i.kt)("p",null,"At the time this query was executed, the dataset had 27,450,499 rows. Let's see what the storage size is of the table in ClickHouse:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT formatReadableSize(total_bytes)\nFROM system.tables\nWHERE name = 'uk_price_paid'\n")),(0,i.kt)("p",null,"Notice the size of the table is just 221.43 MiB!"),(0,i.kt)("h2",{id:"run-queries"},"Run Some Queries"),(0,i.kt)("p",null,"Let's run some queries to analyze the data:"),(0,i.kt)("h3",{id:"average-price"},"Query 1. Average Price Per Year"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n   toYear(date) AS year,\n   round(avg(price)) AS price,\n   bar(price, 0, 1000000, 80\n)\nFROM uk_price_paid\nGROUP BY year\nORDER BY year\n")),(0,i.kt)("p",null,"The result looks like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"\u250c\u2500year\u2500\u252c\u2500\u2500price\u2500\u252c\u2500bar(round(avg(price)), 0, 1000000, 80)\u2500\u2510\n\u2502 1995 \u2502  67934 \u2502 \u2588\u2588\u2588\u2588\u2588\u258d                                 \u2502\n\u2502 1996 \u2502  71508 \u2502 \u2588\u2588\u2588\u2588\u2588\u258b                                 \u2502\n\u2502 1997 \u2502  78536 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u258e                                \u2502\n\u2502 1998 \u2502  85441 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u258b                                \u2502\n\u2502 1999 \u2502  96038 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                               \u2502\n\u2502 2000 \u2502 107487 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                              \u2502\n\u2502 2001 \u2502 118888 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                             \u2502\n\u2502 2002 \u2502 137948 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                            \u2502\n\u2502 2003 \u2502 155893 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                          \u2502\n\u2502 2004 \u2502 178888 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e                        \u2502\n\u2502 2005 \u2502 189359 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                       \u2502\n\u2502 2006 \u2502 203532 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e                      \u2502\n\u2502 2007 \u2502 219375 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                     \u2502\n\u2502 2008 \u2502 217056 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e                     \u2502\n\u2502 2009 \u2502 213419 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                      \u2502\n\u2502 2010 \u2502 236110 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                    \u2502\n\u2502 2011 \u2502 232805 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                    \u2502\n\u2502 2012 \u2502 238381 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                    \u2502\n\u2502 2013 \u2502 256927 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                  \u2502\n\u2502 2014 \u2502 280008 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                \u2502\n\u2502 2015 \u2502 297263 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b               \u2502\n\u2502 2016 \u2502 313518 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588              \u2502\n\u2502 2017 \u2502 346371 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b           \u2502\n\u2502 2018 \u2502 350556 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588           \u2502\n\u2502 2019 \u2502 352184 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f          \u2502\n\u2502 2020 \u2502 375808 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588         \u2502\n\u2502 2021 \u2502 381105 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d        \u2502\n\u2502 2022 \u2502 362572 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,i.kt)("h3",{id:"average-price-london"},"Query 2. Average Price per Year in London"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n   toYear(date) AS year,\n   round(avg(price)) AS price,\n   bar(price, 0, 2000000, 100\n)\nFROM uk_price_paid\nWHERE town = 'LONDON'\nGROUP BY year\nORDER BY year\n")),(0,i.kt)("p",null,"The result looks like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"\u250c\u2500year\u2500\u252c\u2500\u2500\u2500price\u2500\u252c\u2500bar(round(avg(price)), 0, 2000000, 100)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1995 \u2502  109110 \u2502 \u2588\u2588\u2588\u2588\u2588\u258d                                                \u2502\n\u2502 1996 \u2502  118659 \u2502 \u2588\u2588\u2588\u2588\u2588\u258a                                                \u2502\n\u2502 1997 \u2502  136526 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u258b                                               \u2502\n\u2502 1998 \u2502  153002 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                              \u2502\n\u2502 1999 \u2502  180633 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                             \u2502\n\u2502 2000 \u2502  215849 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                           \u2502\n\u2502 2001 \u2502  232987 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                          \u2502\n\u2502 2002 \u2502  263668 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                        \u2502\n\u2502 2003 \u2502  278424 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                                        \u2502\n\u2502 2004 \u2502  304664 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                      \u2502\n\u2502 2005 \u2502  322887 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                     \u2502\n\u2502 2006 \u2502  356195 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                    \u2502\n\u2502 2007 \u2502  404062 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                 \u2502\n\u2502 2008 \u2502  420741 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                 \u2502\n\u2502 2009 \u2502  427754 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                                \u2502\n\u2502 2010 \u2502  480322 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                              \u2502\n\u2502 2011 \u2502  496278 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                             \u2502\n\u2502 2012 \u2502  519482 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                            \u2502\n\u2502 2013 \u2502  616195 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                       \u2502\n\u2502 2014 \u2502  724121 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                 \u2502\n\u2502 2015 \u2502  792101 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c              \u2502\n\u2502 2016 \u2502  843589 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f           \u2502\n\u2502 2017 \u2502  983523 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f    \u2502\n\u2502 2018 \u2502 1016753 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b   \u2502\n\u2502 2019 \u2502 1041673 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2502\n\u2502 2020 \u2502 1060027 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2502\n\u2502 2021 \u2502  958249 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a      \u2502\n\u2502 2022 \u2502  902596 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,i.kt)("p",null,"Something happened to home prices in 2020! But that is probably not a surprise..."),(0,i.kt)("h3",{id:"most-expensive-neighborhoods"},"Query 3. The Most Expensive Neighborhoods"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    town,\n    district,\n    count() AS c,\n    round(avg(price)) AS price,\n    bar(price, 0, 5000000, 100)\nFROM uk_price_paid\nWHERE date >= '2020-01-01'\nGROUP BY\n    town,\n    district\nHAVING c >= 100\nORDER BY price DESC\nLIMIT 100\n")),(0,i.kt)("p",null,"The result looks like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"\u250c\u2500town\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500district\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500c\u2500\u252c\u2500\u2500\u2500price\u2500\u252c\u2500bar(round(avg(price)), 0, 5000000, 100)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 LONDON               \u2502 CITY OF LONDON         \u2502   578 \u2502 3149590 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a \u2502\n\u2502 LONDON               \u2502 CITY OF WESTMINSTER    \u2502  7083 \u2502 2903794 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588      \u2502\n\u2502 LONDON               \u2502 KENSINGTON AND CHELSEA \u2502  4986 \u2502 2333782 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                 \u2502\n\u2502 LEATHERHEAD          \u2502 ELMBRIDGE              \u2502   203 \u2502 2071595 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                      \u2502\n\u2502 VIRGINIA WATER       \u2502 RUNNYMEDE              \u2502   308 \u2502 1939465 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                         \u2502\n\u2502 LONDON               \u2502 CAMDEN                 \u2502  5750 \u2502 1673687 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                              \u2502\n\u2502 WINDLESHAM           \u2502 SURREY HEATH           \u2502   182 \u2502 1428358 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                   \u2502\n\u2502 NORTHWOOD            \u2502 THREE RIVERS           \u2502   112 \u2502 1404170 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                    \u2502\n\u2502 BARNET               \u2502 ENFIELD                \u2502   259 \u2502 1338299 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                     \u2502\n\u2502 LONDON               \u2502 ISLINGTON              \u2502  5504 \u2502 1275520 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                      \u2502\n\u2502 LONDON               \u2502 RICHMOND UPON THAMES   \u2502  1345 \u2502 1261935 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                      \u2502\n\u2502 COBHAM               \u2502 ELMBRIDGE              \u2502   727 \u2502 1251403 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                       \u2502\n\u2502 BEACONSFIELD         \u2502 BUCKINGHAMSHIRE        \u2502   680 \u2502 1199970 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                                        \u2502\n\u2502 LONDON               \u2502 TOWER HAMLETS          \u2502 10012 \u2502 1157827 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                        \u2502\n\u2502 LONDON               \u2502 HOUNSLOW               \u2502  1278 \u2502 1144389 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                                         \u2502\n\u2502 BURFORD              \u2502 WEST OXFORDSHIRE       \u2502   182 \u2502 1139393 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                         \u2502\n\u2502 RICHMOND             \u2502 RICHMOND UPON THAMES   \u2502  1649 \u2502 1130076 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                         \u2502\n\u2502 KINGSTON UPON THAMES \u2502 RICHMOND UPON THAMES   \u2502   147 \u2502 1126111 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                         \u2502\n\u2502 ASCOT                \u2502 WINDSOR AND MAIDENHEAD \u2502   773 \u2502 1106109 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                          \u2502\n\u2502 LONDON               \u2502 HAMMERSMITH AND FULHAM \u2502  6162 \u2502 1056198 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                           \u2502\n\u2502 RADLETT              \u2502 HERTSMERE              \u2502   513 \u2502 1045758 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                                           \u2502\n\u2502 LEATHERHEAD          \u2502 GUILDFORD              \u2502   354 \u2502 1045175 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                                           \u2502\n\u2502 WEYBRIDGE            \u2502 ELMBRIDGE              \u2502  1275 \u2502 1036702 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                           \u2502\n\u2502 FARNHAM              \u2502 EAST HAMPSHIRE         \u2502   107 \u2502 1033682 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                           \u2502\n\u2502 ESHER                \u2502 ELMBRIDGE              \u2502   915 \u2502 1032753 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                           \u2502\n\u2502 FARNHAM              \u2502 HART                   \u2502   102 \u2502 1002692 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                            \u2502\n\u2502 GERRARDS CROSS       \u2502 BUCKINGHAMSHIRE        \u2502   845 \u2502  983639 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                            \u2502\n\u2502 CHALFONT ST GILES    \u2502 BUCKINGHAMSHIRE        \u2502   286 \u2502  973993 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                                            \u2502\n\u2502 SALCOMBE             \u2502 SOUTH HAMS             \u2502   215 \u2502  965724 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e                                            \u2502\n\u2502 SURBITON             \u2502 ELMBRIDGE              \u2502   181 \u2502  960346 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                            \u2502\n\u2502 BROCKENHURST         \u2502 NEW FOREST             \u2502   226 \u2502  951278 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                             \u2502\n\u2502 SUTTON COLDFIELD     \u2502 LICHFIELD              \u2502   110 \u2502  930757 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                             \u2502\n\u2502 EAST MOLESEY         \u2502 ELMBRIDGE              \u2502   372 \u2502  927026 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                             \u2502\n\u2502 LLANGOLLEN           \u2502 WREXHAM                \u2502   127 \u2502  925681 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                             \u2502\n\u2502 OXFORD               \u2502 SOUTH OXFORDSHIRE      \u2502   638 \u2502  923830 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                                             \u2502\n\u2502 LONDON               \u2502 MERTON                 \u2502  4383 \u2502  923194 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                                             \u2502\n\u2502 GUILDFORD            \u2502 WAVERLEY               \u2502   261 \u2502  905733 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                              \u2502\n\u2502 TEDDINGTON           \u2502 RICHMOND UPON THAMES   \u2502  1147 \u2502  894856 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                                              \u2502\n\u2502 HARPENDEN            \u2502 ST ALBANS              \u2502  1271 \u2502  893079 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                              \u2502\n\u2502 HENLEY-ON-THAMES     \u2502 SOUTH OXFORDSHIRE      \u2502  1042 \u2502  887557 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                              \u2502\n\u2502 POTTERS BAR          \u2502 WELWYN HATFIELD        \u2502   314 \u2502  863037 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e                                              \u2502\n\u2502 LONDON               \u2502 WANDSWORTH             \u2502 13210 \u2502  857318 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                              \u2502\n\u2502 BILLINGSHURST        \u2502 CHICHESTER             \u2502   255 \u2502  856508 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                              \u2502\n\u2502 LONDON               \u2502 SOUTHWARK              \u2502  7742 \u2502  843145 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                               \u2502\n\u2502 LONDON               \u2502 HACKNEY                \u2502  6656 \u2502  839716 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                               \u2502\n\u2502 LUTTERWORTH          \u2502 HARBOROUGH             \u2502  1096 \u2502  836546 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                               \u2502\n\u2502 KINGSTON UPON THAMES \u2502 KINGSTON UPON THAMES   \u2502  1846 \u2502  828990 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                               \u2502\n\u2502 LONDON               \u2502 EALING                 \u2502  5583 \u2502  820135 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                                               \u2502\n\u2502 INGATESTONE          \u2502 CHELMSFORD             \u2502   120 \u2502  815379 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e                                               \u2502\n\u2502 MARLOW               \u2502 BUCKINGHAMSHIRE        \u2502   718 \u2502  809943 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                               \u2502\n\u2502 EAST GRINSTEAD       \u2502 TANDRIDGE              \u2502   105 \u2502  809461 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                               \u2502\n\u2502 CHIGWELL             \u2502 EPPING FOREST          \u2502   484 \u2502  809338 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                               \u2502\n\u2502 EGHAM                \u2502 RUNNYMEDE              \u2502   989 \u2502  807858 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                               \u2502\n\u2502 HASLEMERE            \u2502 CHICHESTER             \u2502   223 \u2502  804173 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                \u2502\n\u2502 PETWORTH             \u2502 CHICHESTER             \u2502   288 \u2502  803206 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                \u2502\n\u2502 TWICKENHAM           \u2502 RICHMOND UPON THAMES   \u2502  2194 \u2502  802616 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                \u2502\n\u2502 WEMBLEY              \u2502 BRENT                  \u2502  1698 \u2502  801733 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                \u2502\n\u2502 HINDHEAD             \u2502 WAVERLEY               \u2502   233 \u2502  801482 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                \u2502\n\u2502 LONDON               \u2502 BARNET                 \u2502  8083 \u2502  792066 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                                \u2502\n\u2502 WOKING               \u2502 GUILDFORD              \u2502   343 \u2502  789360 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                                \u2502\n\u2502 STOCKBRIDGE          \u2502 TEST VALLEY            \u2502   318 \u2502  777909 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                                \u2502\n\u2502 BERKHAMSTED          \u2502 DACORUM                \u2502  1049 \u2502  776138 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                                \u2502\n\u2502 MAIDENHEAD           \u2502 BUCKINGHAMSHIRE        \u2502   236 \u2502  775572 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                                \u2502\n\u2502 SOLIHULL             \u2502 STRATFORD-ON-AVON      \u2502   142 \u2502  770727 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                                                \u2502\n\u2502 GREAT MISSENDEN      \u2502 BUCKINGHAMSHIRE        \u2502   431 \u2502  764493 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e                                                \u2502\n\u2502 TADWORTH             \u2502 REIGATE AND BANSTEAD   \u2502   920 \u2502  757511 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                                \u2502\n\u2502 LONDON               \u2502 BRENT                  \u2502  4124 \u2502  757194 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                                \u2502\n\u2502 THAMES DITTON        \u2502 ELMBRIDGE              \u2502   470 \u2502  750828 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                 \u2502\n\u2502 LONDON               \u2502 LAMBETH                \u2502 10431 \u2502  750532 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                 \u2502\n\u2502 RICKMANSWORTH        \u2502 THREE RIVERS           \u2502  1500 \u2502  747029 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                                                 \u2502\n\u2502 KINGS LANGLEY        \u2502 DACORUM                \u2502   281 \u2502  746536 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                                                 \u2502\n\u2502 HARLOW               \u2502 EPPING FOREST          \u2502   172 \u2502  739423 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                                 \u2502\n\u2502 TONBRIDGE            \u2502 SEVENOAKS              \u2502   103 \u2502  738740 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                                 \u2502\n\u2502 BELVEDERE            \u2502 BEXLEY                 \u2502   686 \u2502  736385 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                                 \u2502\n\u2502 CRANBROOK            \u2502 TUNBRIDGE WELLS        \u2502   769 \u2502  734328 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                                 \u2502\n\u2502 SOLIHULL             \u2502 WARWICK                \u2502   116 \u2502  733286 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                                 \u2502\n\u2502 ALDERLEY EDGE        \u2502 CHESHIRE EAST          \u2502   357 \u2502  732882 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                                 \u2502\n\u2502 WELWYN               \u2502 WELWYN HATFIELD        \u2502   404 \u2502  730281 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                                 \u2502\n\u2502 CHISLEHURST          \u2502 BROMLEY                \u2502   870 \u2502  730279 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                                 \u2502\n\u2502 LONDON               \u2502 HARINGEY               \u2502  6488 \u2502  726715 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                                 \u2502\n\u2502 AMERSHAM             \u2502 BUCKINGHAMSHIRE        \u2502   965 \u2502  725426 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                                 \u2502\n\u2502 SEVENOAKS            \u2502 SEVENOAKS              \u2502  2183 \u2502  725102 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                                 \u2502\n\u2502 BOURNE END           \u2502 BUCKINGHAMSHIRE        \u2502   269 \u2502  724595 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                                                 \u2502\n\u2502 NORTHWOOD            \u2502 HILLINGDON             \u2502   568 \u2502  722436 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                                                 \u2502\n\u2502 PURFLEET             \u2502 THURROCK               \u2502   143 \u2502  722205 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                                                 \u2502\n\u2502 SLOUGH               \u2502 BUCKINGHAMSHIRE        \u2502   832 \u2502  721529 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d                                                 \u2502\n\u2502 INGATESTONE          \u2502 BRENTWOOD              \u2502   301 \u2502  718292 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e                                                 \u2502\n\u2502 EPSOM                \u2502 REIGATE AND BANSTEAD   \u2502   315 \u2502  709264 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                                 \u2502\n\u2502 ASHTEAD              \u2502 MOLE VALLEY            \u2502   524 \u2502  708646 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                                 \u2502\n\u2502 BETCHWORTH           \u2502 MOLE VALLEY            \u2502   155 \u2502  708525 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                                 \u2502\n\u2502 OXTED                \u2502 TANDRIDGE              \u2502   645 \u2502  706946 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f                                                 \u2502\n\u2502 READING              \u2502 SOUTH OXFORDSHIRE      \u2502   593 \u2502  705466 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                  \u2502\n\u2502 FELTHAM              \u2502 HOUNSLOW               \u2502  1536 \u2502  703815 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                  \u2502\n\u2502 TUNBRIDGE WELLS      \u2502 WEALDEN                \u2502   207 \u2502  703296 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                  \u2502\n\u2502 LEWES                \u2502 WEALDEN                \u2502   116 \u2502  701349 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                  \u2502\n\u2502 OXFORD               \u2502 OXFORD                 \u2502  3656 \u2502  700813 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                  \u2502\n\u2502 MAYFIELD             \u2502 WEALDEN                \u2502   177 \u2502  698158 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                                                  \u2502\n\u2502 PINNER               \u2502 HARROW                 \u2502   997 \u2502  697876 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                                                  \u2502\n\u2502 LECHLADE             \u2502 COTSWOLD               \u2502   155 \u2502  696262 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a                                                  \u2502\n\u2502 WALTON-ON-THAMES     \u2502 ELMBRIDGE              \u2502  1850 \u2502  690102 \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,i.kt)("h2",{id:"speedup-with-projections"},"Let's Speed Up Queries Using Projections"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/alter/projection"},"Projections")," allow you to improve query speeds by storing pre-aggregated data in whatever format you want. In this example, we create a projection that keeps track of the average price, total price, and count of properties grouped by the year, district and town. At execution time, ClickHouse will use your projection if it thinks the projection can improve the performance fo the query (you don't have to do anything special to use the projection - ClickHouse decides for you when the projection will be useful)."),(0,i.kt)("h3",{id:"build-projection"},"Build a Projection"),(0,i.kt)("p",null,"Let's create an aggregate projection by the dimensions ",(0,i.kt)("inlineCode",{parentName:"p"},"toYear(date)"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"district"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"town"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE uk_price_paid\n    ADD PROJECTION projection_by_year_district_town\n    (\n        SELECT\n            toYear(date),\n            district,\n            town,\n            avg(price),\n            sum(price),\n            count()\n        GROUP BY\n            toYear(date),\n            district,\n            town\n    )\n")),(0,i.kt)("p",null,"Populate the projection for existing data. (Without materializing it, the projection will be created for only newly inserted data):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE uk_price_paid\n    MATERIALIZE PROJECTION projection_by_year_district_town\nSETTINGS mutations_sync = 1\n")),(0,i.kt)("h2",{id:"test-performance"},"Test Performance"),(0,i.kt)("p",null,"Let's run the same 3 queries again:"),(0,i.kt)("h3",{id:"average-price-projections"},"Query 1. Average Price Per Year"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    toYear(date) AS year,\n    round(avg(price)) AS price,\n    bar(price, 0, 1000000, 80)\nFROM uk_price_paid\nGROUP BY year\nORDER BY year ASC\n")),(0,i.kt)("p",null,"The result is the same, but the performance is better!"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"No projection:   28 rows in set. Elapsed: 1.775 sec. Processed 27.45 million rows, 164.70 MB (15.47 million rows/s., 92.79 MB/s.)\nWith projection: 28 rows in set. Elapsed: 0.665 sec. Processed 87.51 thousand rows, 3.21 MB (131.51 thousand rows/s., 4.82 MB/s.)\n")),(0,i.kt)("h3",{id:"average-price-london-projections"},"Query 2. Average Price Per Year in London"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    toYear(date) AS year,\n    round(avg(price)) AS price,\n    bar(price, 0, 2000000, 100)\nFROM uk_price_paid\nWHERE town = 'LONDON'\nGROUP BY year\nORDER BY year ASC\n")),(0,i.kt)("p",null,"Same result, but notice the improvement in query performance:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"No projection:   28 rows in set. Elapsed: 0.720 sec. Processed 27.45 million rows, 46.61 MB (38.13 million rows/s., 64.74 MB/s.)\nWith projection: 28 rows in set. Elapsed: 0.015 sec. Processed 87.51 thousand rows, 3.51 MB (5.74 million rows/s., 230.24 MB/s.)\n")),(0,i.kt)("h3",{id:"most-expensive-neighborhoods-projections"},"Query 3. The Most Expensive Neighborhoods"),(0,i.kt)("p",null,"The condition (date >= '2020-01-01') needs to be modified so that it matches the projection dimension (",(0,i.kt)("inlineCode",{parentName:"p"},"toYear(date) >= 2020)"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    town,\n    district,\n    count() AS c,\n    round(avg(price)) AS price,\n    bar(price, 0, 5000000, 100)\nFROM uk_price_paid\nWHERE toYear(date) >= 2020\nGROUP BY\n    town,\n    district\nHAVING c >= 100\nORDER BY price DESC\nLIMIT 100\n")),(0,i.kt)("p",null,"Again, the result is the same but notice the improvement in query performance:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"No projection:   100 rows in set. Elapsed: 0.928 sec. Processed 27.45 million rows, 103.80 MB (29.56 million rows/s., 111.80 MB/s.)\nWith projection: 100 rows in set. Elapsed: 0.336 sec. Processed 17.32 thousand rows, 1.23 MB (51.61 thousand rows/s., 3.65 MB/s.)\n")),(0,i.kt)("h3",{id:"playground"},"Test it in the Playground"),(0,i.kt)("p",null,"The dataset is also available in the ",(0,i.kt)("a",{parentName:"p",href:"https://play.clickhouse.com/play?user=play#U0VMRUNUIHRvd24sIGRpc3RyaWN0LCBjb3VudCgpIEFTIGMsIHJvdW5kKGF2ZyhwcmljZSkpIEFTIHByaWNlLCBiYXIocHJpY2UsIDAsIDUwMDAwMDAsIDEwMCkgRlJPTSB1a19wcmljZV9wYWlkIFdIRVJFIGRhdGUgPj0gJzIwMjAtMDEtMDEnIEdST1VQIEJZIHRvd24sIGRpc3RyaWN0IEhBVklORyBjID49IDEwMCBPUkRFUiBCWSBwcmljZSBERVNDIExJTUlUIDEwMA=="},"Online Playground"),"."))}E.isMDXComponent=!0}}]);